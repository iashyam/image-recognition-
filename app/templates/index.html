<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image Label Prediction</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h2>Image Label Prediction</h2>
        <div class="drop-area" id="drop-area">
            <span id="drop-text">Drag & Drop Image Here or <label for="fileElem" style="color:#5a67d8;cursor:pointer;text-decoration:underline;">Browse</label></span>
            <input type="file" id="fileElem" accept="image/*">
        </div>
        <img id="preview" src="#" alt="Preview"/>
        <button id="uploadBtn">Predict Label</button>
        <div id="result"></div>
    </div>
    <script>
        const dropArea = document.getElementById('drop-area');
        const fileElem = document.getElementById('fileElem');
        const uploadBtn = document.getElementById('uploadBtn');
        const preview = document.getElementById('preview');
        let file;

        function showPreview(imgFile) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(imgFile);
        }

        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('dragover');
        });
        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('dragover');
        });
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('dragover');
            file = e.dataTransfer.files[0];
            fileElem.files = e.dataTransfer.files;
            showPreview(file);
        });
        fileElem.addEventListener('change', (e) => {
            file = e.target.files[0];
            showPreview(file);
        });
        uploadBtn.addEventListener('click', () => {
            if (!file) {
                document.getElementById('result').textContent = 'Please select an image.';
                return;
            }
            const formData = new FormData();
            formData.append('image', file);
            document.getElementById('result').textContent = 'Predicting...';
            fetch('/predict', {
                method: 'POST',
                body: formData
            })
            .then(res => res.json())
            .then(data => {
                if (data.label) {
                    document.getElementById('result').textContent = 'Predicted Label: ' + data.label;
                } else {
                    document.getElementById('result').textContent = 'Error: ' + (data.error || 'Unknown error');
                }
            })
            .catch(() => {
                document.getElementById('result').textContent = 'Error uploading image.';
            });
        });
    </script>
</body>
</html>
